<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:context="http://www.springframework.org/schema/context"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd



        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd">

<import resource="applicationContext-dataSource.xml" />
	<import resource="applicationContext-transaction.xml" />
	<import resource="applicationContext-task.xml" />
	<import resource="classpath*:/applicationContext-unitdao.xml" />
	<import resource="classpath*:/applicationContext-appldao.xml" />
	<context:component-scan
			base-package="cn.xuetao, eframework.**.service, eframework.dao, cn.dayread.data, cn.pdf,cn.accountinfo, cn.xuetao.MNS.service, cn.WeChat.service" />
	<context:annotation-config/>

	<!-- 将session放入redis -->
	<bean id="redisHttpSessionConfiguration"
		  class="org.springframework.session.data.redis.config.annotation.web.http.RedisHttpSessionConfiguration">
		<property name="maxInactiveIntervalInSeconds" value="1800" />
	</bean>

	<!-- redis dudus -->
	<bean id="jedisPoolConfig" class="redis.clients.jedis.JedisPoolConfig">
	</bean>

	<bean id="jedisConnectionFactory"
		  class="org.springframework.data.redis.connection.jedis.JedisConnectionFactory">
		<property name="hostName" value="${redis.server}" />
		<property name="port" value="${redis.port}" />
		<property name="password" value="${redis.password}" />
		<property name="timeout" value="${redis.timeout}" />
		<property name="poolConfig" ref="${redis.poolConfig}" />
		<property name="usePool" value="${redis.usePool}" />
	</bean>

	<bean id="stringRedisSerializer" class="org.springframework.data.redis.serializer.StringRedisSerializer"/>
	<bean id="valueSerializer" class="org.springframework.data.redis.serializer.JdkSerializationRedisSerializer"/>

	<bean id="redisTemplate" class="org.springframework.data.redis.core.StringRedisTemplate">
		<property name="connectionFactory" ref="jedisConnectionFactory" />
		<property name="defaultSerializer" ref="stringRedisSerializer"/>
		<property name="keySerializer" ref="stringRedisSerializer"/>
		<property name="valueSerializer" ref="valueSerializer"/>
	</bean>

	<!-- MessageSourceの設定 -->
	<bean name="messageSource"
		  class="org.springframework.context.support.ResourceBundleMessageSource">
		<property name="basenames">
			<list>
				<value>messages</value>
			</list>
		</property>
	</bean>
	<!-- MessageSourceの設定 -->
	<bean name="jacksonMessageConverter"
		  class="org.springframework.http.converter.json.MappingJacksonHttpMessageConverter">
		<property name="supportedMediaTypes">
			<list>
				<value>text/html;charset=UTF-8</value>
			</list>
		</property>
	</bean>
	<bean class="cn.xuetao.core.SpringContextHolder" />

	<!-- define the SqlSessionFactory -->
	<bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
		<property name="dataSource" ref="dataSource" />
		<property name="mapperLocations">
			<list>
				<value>classpath*:mappers/**/*.xml</value>
			</list>
		</property>
		<property name="typeAliasesPackage" value="cn.xuetao.common.data.entities" />
	</bean>

	<!-- scan for mappers and let them be autowired -->
	<bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">
		<property name="basePackage" value="cn.xuetao.**.mapper,cn.xuetao.**.**.mapper, cn.dayread.data.mappers, cn.pdf.data.mapper, cn.accountinfo.data.mapper, cn.WeChat.data.mapper" />
	</bean>

	<!-- production环境  新加入redis的配置 -->
	<beans profile="production">
		<context:property-placeholder location="classpath:app.properties, classpath:redis.properties" />
	</beans>

	<!-- development环境  新加入redis的配置 -->
	<beans profile="development">
		<context:property-placeholder location="classpath:app.properties, classpath:app_dev.properties, classpath:redis.properties" />
	</beans>
</beans>
